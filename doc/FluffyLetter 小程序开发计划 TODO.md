# FluffyLetter 小程序开发计划 TODO

## 一、整体规划与环境搭建

- [x] 明确目标版本：V1（包含：首页/分类/详情/收藏页/联系我们/关于我们 + 多语言 + 收藏功能）
- [x] 安装/检查开发工具：微信开发者工具、Node（如需工具链）、Git
- [x] 在微信开放平台创建小程序应用，获取 AppID
- [x] 在现有项目中配置 AppID、基础项目设置（app.json、project.config.json 等）
- [x] 在微信开发者工具中导入项目并保证能正常预览现有示例页

## 二、项目结构与基础配置

- [x] 规划 pages 目录结构（首页、分类、详情、收藏、联系我们、关于我们）
- [ ] 统一全局样式（字体、主色、圆角、阴影等苹果风格基础样式）
- [ ] 配置全局导航栏与底部 Tab（如需要 TabBar）
- [ ] 设计/导入基础图标（logo、收藏图标、语言切换图标等）
- [ ] 定义接口基础配置：后端域名、统一 request 封装、错误处理、loading 管理

## 三、公共能力与工具模块

- [ ] 封装 `request` 工具（支持：baseUrl、超时、多语言参数 lang、token 注入）
- [ ] 封装用户登录模块：
  - [ ] 调用 `wx.login` 获取 code
  - [ ] 请求后端登录接口换取 userToken（内部绑定 openid）
  - [ ] 将 userToken 缓存到本地（storage），并在请求头中自动携带
- [ ] 设计全局状态管理方案（简单可以用全局 app 实例 + storage）
  - [ ] 当前语言 lang
  - [ ] 用户登录状态 / userToken
  - [ ] 收藏列表缓存（可选）
- [ ] 多语言本地文案文件（zh.js / en.js）与简单的 i18n 工具函数
- [ ] 常用 UI 组件库整理（如自定义按钮、商品卡片、空状态组件等）

## 四、页面开发 TODO

### 4.1 首页

- [ ] 设计首页 WXML 结构：顶部导航栏、轮播图、推荐商品区、悬浮联系我们按钮
- [ ] 接入分类/推荐商品接口（如：热门 / 推荐商品列表）
- [ ] 轮播图组件开发与数据绑定
- [ ] 商品卡片组件复用（名称、价格、折扣、热卖标识、多语言）
- [ ] 顶部导航交互：
  - [ ] 点击品牌 logo 跳转关于我们页
  - [ ] 搜索入口（跳转到分类页或搜索结果）
  - [ ] 收藏按钮跳转收藏页
  - [ ] 语言切换按钮（切换全局 lang 并刷新页面数据）
- [ ] 悬浮联系我们按钮跳转联系我们页

### 4.2 分类页

- [ ] 页面结构：搜索框、分类 tab 条、商品列表、滚动加载
- [ ] 接入分类列表接口 `/api/categories?lang=...`
- [ ] 接入商品列表接口 `/api/products?category_id=&lang=&page=&size=`
- [ ] 搜索逻辑：本地输入 + 请求带关键词（如后端支持）
- [ ] 分页/上拉加载更多逻辑
- [ ] 点击商品卡片跳转到详情页

### 4.3 商品详情页

- [ ] 页面结构：图片轮播、基本信息、价格/折扣、热卖标识、详细描述、收藏按钮、联系我们按钮
- [ ] 接入商品详情接口 `/api/products/{id}?lang=...`
- [ ] 渲染多语言内容（名称、简介、描述）
- [ ] 收藏按钮 UI 与状态（根据返回的 `is_favorited` 初始化）
- [ ] 收藏/取消收藏的交互与接口联动
- [ ] 联系我们按钮跳转联系我们页或拉起微信客服

### 4.4 收藏页

- [ ] 页面结构：商品列表、空状态展示
- [ ] 进入页面时调用 `/api/favorites?lang=&page=&size=` 获取当前用户收藏列表
- [ ] 使用统一商品卡片组件展示收藏商品
- [ ] 下拉刷新 / 重新拉取收藏列表
- [ ] 在收藏页支持取消收藏（调用 DELETE /api/favorites/{productId}，从当前列表移除）

### 4.5 联系我们页

- [ ] 页面结构：微信号展示、二维码图片、复制微信号按钮、保存二维码按钮
- [ ] 接入 `/api/contact` 接口获取微信号和二维码地址
- [ ] 实现复制微信号到剪贴板
- [ ] 实现长按/按钮保存二维码图片到相册（含授权处理）

### 4.6 关于我们页

- [ ] 基本品牌故事文案布局（多语言）
- [ ] 可选图片展示（品牌图片、工作台照片等）
- [ ] 文案来源：本地多语言文件或后端接口（根据后端实际设计）

## 五、收藏功能（基于 openid）的实现细化

- [ ] 在小程序启动时完成微信登录 + 后端登录流程，确保获取 userToken
- [ ] request 工具中自动注入 Authorization（如 `Bearer userToken`）
- [ ] 商品详情页：
  - [ ] 根据接口返回的 `is_favorited` 设置收藏按钮初始状态
  - [ ] 点击收藏 → 调用 `POST /api/favorites/{productId}` → 成功后更新 UI
  - [ ] 点击取消收藏 → 调用 `DELETE /api/favorites/{productId}` → 成功后更新 UI
- [ ] 收藏页：
  - [ ] 首次进入时加载用户收藏列表
  - [ ] 在详情页操作收藏后返回时，支持刷新状态（重新拉取或通过事件/全局缓存更新）
- [ ] 异常处理：
  - [ ] 未登录 / token 失效时，自动触发重新登录流程或提示重新授权
  - [ ] 收藏接口异常时给出友好提示

## 六、多语言支持落地

- [ ] 设计多语言配置结构：`i18n/zh.js`、`i18n/en.js`
- [ ] 全局语言切换逻辑与持久化（storage + 全局状态）
- [ ] 页面中固定文案都通过 i18n 工具获取
- [ ] 所有接口请求统一带上 `lang` 参数
- [ ] 切换语言后刷新当前页面数据（重新请求 / 重渲染）

## 七、测试、自测与发布准备

- [ ] 按页面进行功能自测（含中/英文两种语言）
- [ ] 在真机上测试性能与兼容性（iOS/Android）
- [ ] 测试弱网/接口失败时的提示与降级体验
- [ ] 检查收藏数据在多设备登录时是否正确同步（基于 openid）
- [ ] 检查图片加载与懒加载效果，优化首屏体验
- [ ] 填写小程序基础信息、类目、体验版发布与体验账号配置
- [ ] 预发布检查单确认（隐私合规、联系方式、必要说明）
